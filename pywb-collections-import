#!/bin/bash

import_collection_and_delete_files() {
    local collection_name="$1"
    local file_pattern="$2"
    
    local files=($(shopt -s nullglob dotglob; find /mnt/omega/web-archives/import -iname "$file_pattern"))
    if (( ${#files[@]} )); then
        cd /mnt/omega/web-archives
        wb-manager add "$collection_name" "${files[0]}"
        find /mnt/omega/web-archives/import -iname "$file_pattern" -type f -delete
    fi
}

# Activate Python virtual env.
cd /opt
python3 -m venv pywbenv
source pywbenv/bin/activate

# Import collections and delete related files
import_collection_and_delete_files "academic-calendars" "YORK-ACADEMIC-CALENDARS*warc.gz"
import_collection_and_delete_files "NRTEE" "NRTEE*warc.gz"
import_collection_and_delete_files "yul" "YORK-LIBRARIES*warc.gz"
import_collection_and_delete_files "yu-crs" "YU-JGRANT*warc.gz"
import_collection_and_delete_files "yu-magazine" "MAGAZINE*warc.gz"
import_collection_and_delete_files "yu-crs" "SECRETARIAT*warc.gz"
import_collection_and_delete_files "yfile" "YFILE*warc.gz"
